import numpy as np
import matplotlib.pyplot as plt
from scipy.signal import freqz

# FIR taps
b = np.array([
    0.000241931009, 5.02136622e-05, -1.31761105e-06, 0.000135797005, 0.000377193862,
    0.000558852411, 0.00054991899, 0.000350214392, 0.000101717581, -2.59763771e-06,
    0.000142884498, 0.000467362034, 0.000756131565, 0.000795795598, 0.000537189634,
    0.000154345372, -5.99767023e-05, 9.54665635e-05, 0.000561995056, 0.00103083674,
    0.00114856838, 0.000785590584, 0.000167102353, -0.000254618935, -0.000122303807,
    0.000535115033, 0.00127382678, 0.00152616832, 0.00102594707, 5.34544172e-05,
    -0.000713945729, -0.000678820892, 0.000202611882, 0.00131914614, 0.00179941637,
    0.00115527977, -0.000296420987, -0.00158648266, -0.0017678498, -0.000648885629,
    0.000975062376, 0.00182594617, 0.00107396521, -0.00097684496, -0.00300263972,
    -0.0035696041, -0.0022225176, 6.60788996e-05, 0.00149603748, 0.000734375927,
    -0.00201854142, -0.00503073496, -0.00621174269, -0.00467392244, -0.00152605488,
    0.000780704991, 0.000193508334, -0.00333958338, -0.00763998688, -0.00974624797,
    -0.00809395424, -0.00383727244, -0.000226523066, -0.000333484826, -0.00469883703,
    -0.0106815281, -0.014163483, -0.0125370887, -0.00683003291, -0.00127447281,
    -0.000403446412, -0.00563707751, -0.0138947387, -0.0194821161, -0.0181491539,
    -0.0104667716, -0.0018998054, 0.000820368752, -0.00532735409, -0.0169402213,
    -0.0260368181, -0.0255816033, -0.01495093, -0.00122026553, 0.00520519551,
    -0.0019483596, -0.0194540496, -0.0356017757, -0.0377476212, -0.0217617259,
    0.00329564933, 0.0194554356, 0.0114843852, -0.0211122695, -0.0599952922,
    -0.0758661628, -0.0449757984, 0.0350676593, 0.140088588, 0.228976712,
    0.263723617, 0.228976712, 0.140088588, 0.0350676593, -0.0449757984,
    -0.0758661628, -0.0599952922, -0.0211122695, 0.0114843852, 0.0194554356,
    0.00329564933, -0.0217617259, -0.0377476212, -0.0356017757, -0.0194540496,
    -0.0019483596, 0.00520519551, -0.00122026553, -0.01495093, -0.0255816033,
    -0.0260368181, -0.0169402213, -0.00532735409, 0.000820368752, -0.0018998054,
    -0.0104667716, -0.0181491539, -0.0194821161, -0.0138947387, -0.00563707751,
    -0.000403446412, -0.00127447281, -0.00683003291, -0.0125370887, -0.014163483,
    -0.0106815281, -0.00469883703, -0.000333484826, -0.000226523066,
    -0.00383727244, -0.00809395424, -0.00974624797, -0.00763998688, -0.00333958338,
    0.000193508334, 0.000780704991, -0.00152605488, -0.00467392244, -0.00621174269,
    -0.00503073496, -0.00201854142, 0.000734375927, 0.00149603748, 6.60788996e-05,
    -0.0022225176, -0.0035696041, -0.00300263972, -0.00097684496, 0.00107396521,
    0.00182594617, 0.000975062376, -0.000648885629, -0.0017678498, -0.00158648266,
    -0.000296420987, 0.00115527977, 0.00179941637, 0.00131914614, 0.000202611882,
    -0.000678820892, -0.000713945729, 5.34544172e-05, 0.00102594707, 0.00152616832,
    0.00127382678, 0.000535115033, -0.000122303807, -0.000254618935, 0.000167102353,
    0.000785590584, 0.00114856838, 0.00103083674, 0.000561995056, 9.54665635e-05,
    -5.99767023e-05, 0.000154345372, 0.000537189634, 0.000795795598, 0.000756131565,
    0.000467362034, 0.000142884498, -2.59763771e-06, 0.000101717581,
    0.000350214392, 0.00054991899, 0.000558852411, 0.000377193862,
    0.000135797005, -1.31761105e-06, 5.02136622e-05, 0.000241931009
], dtype=float)

fs = 250.0  # sampling rate (Hz)

# Frequency response
w, h = freqz(b, worN=8192)
f = (w / (2 * np.pi)) * fs

mag = np.abs(h)
mag_db = 20 * np.log10(np.maximum(mag, 1e-12))

print("Number of taps:", len(b))
print("Sum of taps (DC gain):", np.sum(b))

# Linear magnitude
plt.figure()
plt.plot(f, mag)
plt.title("FIR Magnitude Response (Linear)")
plt.xlabel("Frequency (Hz)")
plt.ylabel("|H(f)|")
plt.xlim(0, fs / 2)
plt.grid(True)

# dB magnitude
plt.figure()
plt.plot(f, mag_db)
plt.title("FIR Magnitude Response (dB)")
plt.xlabel("Frequency (Hz)")
plt.ylabel("Magnitude (dB)")
plt.xlim(0, fs / 2)
plt.ylim(-120, 10)
plt.grid(True)

plt.show()
