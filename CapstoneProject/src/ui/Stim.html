<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>EEG BCI Page-Turner – Local UI</title>
    <link rel="stylesheet" href="Stim.css?v=20251122-5" />
  </head>
  <body>
    <div class="app-shell">
      <!-- Left: status + config -->
      <aside class="sidebar">
        <header class="app-header">
          <h1>EEG BCI Page-Turner</h1>
          <p class="subtitle">Local Stimulus & State Monitor</p>
        </header>

        <section class="status-card">
          <div id="connection-status" class="status-pill">
            <span class="dot"></span>
            <span id="connection-label">Disconnected</span>
          </div>
          <div class="status-row">
            <span class="label">Monitor refresh</span>
            <span id="refresh-label" class="value">Measuring…</span>
          </div>
        </section>

        <section class="state-card">
          <h2>Controller State Store</h2>
          <div class="state-row">
            <span class="label">Sequence</span>
            <span id="seq-value" class="value">—</span>
          </div>
          <div class="state-row">
            <span class="label">Stimulus Window</span>
            <span id="stim-window-value" class="value">—</span>
          </div>
          <div class="state-row">
            <span class="label">Block Id</span>
            <span id="block-value" class="value">0</span>
          </div>
          <div class="state-row">
            <span class="label">Frequency</span>
            <span id="freq-hz-value" class="value">—</span>
          </div>
          <div class="state-row">
            <span class="label">Frequency Enum Value</span>
            <span id="freq-code-pill" class="pill pill-soft">—</span>
          </div>
        </section>

        <section class="controls-card">
          <h2>Session Controls</h2>
          <div class="button-row">
            <button id="btn-start-calib" class="btn ghost">
              Start Calibration
            </button>
            <button id="btn-start-run" class="btn primary">
              Start Run Mode
            </button>
            <button id="btn-start-hw" class="btn ghost">Hardware Setup</button>
          </div>
        </section>
      </aside>

      <!-- Right: main view area -->
      <main class="main-panel">
        <!-- Full-screen exit button (shown in calib/run) -->
        <button id="btn-exit" class="btn exit-btn hidden" type="button">
          Exit Session
        </button>
        <!-- main VIEW STACK (fills most of the right side) -->
        <div class="view-stack">
          <!-- HOME VIEW -->
          <section id="view-home" class="view">
            <h2>Home</h2>
            <p class="view-lead">
              Connect the C++ backend and choose a session type to begin.
            </p>
            <ul class="bullets">
              <li>
                Calibration: single-frequency blocks to train the SSVEP
                classifier.
              </li>
              <li>Run Mode: dual-frequency arrows for page turning.</li>
            </ul>
          </section>

          <!-- INSTRUCTIONS VIEW -->
          <section id="view-instructions" class="view hidden">
            <h2>Instructions</h2>
            <p id="instructions-text" class="view-lead">
              Rest for a few seconds, then focus on the indicated flicker block.
            </p>
            <div class="inline-stats">
              <div>
                <span class="label">Block</span>
                <span id="instr-block-id" class="value">—</span>
              </div>
              <div>
                <span class="label">Upcoming frequency</span>
                <span id="instr-freq-hz" class="value">— Hz</span>
              </div>
            </div>
          </section>

          <!-- ACTIVE CALIBRATION VIEW -->
          <section id="view-active-calib" class="view hidden">
            <h2>Calibration Block</h2>
            <p class="view-lead">
              Focus your gaze on the flickering square to record your SSVEP
              responses.
            </p>
            <div class="flicker-stage">
              <div id="calib-block" class="flicker-block"></div>
            </div>
          </section>

          <!-- ACTIVE RUN VIEW -->
          <section id="view-active-run" class="view hidden">
            <h2>Page Turning</h2>
            <p class="view-lead">
              Look at the left or right arrow to turn pages backward or forward.
            </p>
            <div class="flicker-stage dual">
              <div id="left-arrow" class="flicker-block arrow-left">←</div>
              <div id="right-arrow" class="flicker-block arrow-right">→</div>
            </div>
          </section>
        </div>

        <!-- RUN OPTIONS VIEW (START DEFAULT OR SEE PREV SESSIONS) -->
        <section id="view-run-options" class="view hidden">
          <h2>Run Options</h2>
          <p class="view-lead">
            Welcome back, <span id="run-welcome-name">friend</span>. Choose how
            you want to start the session.
          </p>

          <div class="inline-stats">
            <div>
              <span class="label">Last trained subject</span>
              <span id="run-last-subject" class="value">—</span>
            </div>
            <div>
              <span class="label">Model status</span>
              <span id="run-model-status" class="value">—</span>
            </div>
          </div>

          <div class="button-row" style="margin-top: 14px">
            <button id="btn-run-start-default" class="btn primary">
              Start with latest model
            </button>
            <button id="btn-run-saved-sessions" class="btn ghost">
              Choose saved session…
            </button>
          </div>
        </section>

        <!-- HARDWARE CHECKS VIEW -->
        <section id="view-hardware-checks" class="view hidden">
          <h2>Hardware Setup & Signal Quality Checker</h2>
          <br />
          <p class="view-lead">
            Verify headset placement and electrode contact by inspecting
            per-channel signal quality indicators and live EEG trace.
          </p>
          <br />

          <!-- Quality indicators row -->
          <div id="hw-quality-row" class="hw-quality-row">
            <!-- pills will be injected by JS get requests to backend -->
          </div>
          <!-- Scrollable container with stacked channel plots -->
          <div id="hw-plots-container" class="hw-plots-container">
            <!-- channel canvases will be injected by JS -->
          </div>
        </section>

        <!-- SESSIONS PAGE VIEW -->
        <section id="view-saved-sessions" class="view hidden">
          <h2>Saved Sessions</h2>
          <p class="view-lead">
            Select a previous session to load its trained model, or start a new
            one.
          </p>

          <!-- Placeholder list; filled from GET /state as calib sessions are run -->
          <!-- will be made clickable in css -->
          <div id="sessions-empty" class="label" style="margin-bottom: 8px">
            No saved sessions yet.
          </div>
          <ul id="sessions-list" class="sessions-list">
            <!-- <li> items injected by JS -->
          </ul>

          <div class="button-row" style="margin-top: 14px">
            <button id="btn-sessions-new" class="btn primary">
              Start new session
            </button>
            <button id="btn-sessions-back" class="btn ghost">
              Back to run options
            </button>
          </div>
        </section>

        <!-- MODAL OVERLAY (popups) -->
        <div id="modal-backdrop" class="modal-backdrop hidden">
          <div class="modal">
            <h3 id="modal-title">Notice</h3>
            <p id="modal-body">
              You must complete at least one calibration session before starting
              run mode.
            </p>
            <div class="button-row" style="margin-top: 10px">
              <button id="modal-ok" class="btn primary">OK</button>
            </div>
          </div>
        </div>

        <!-- LOG PANEL (small strip at the bottom) -->
        <section class="log-panel">
          <h3>Event Log</h3>
          <div id="log" class="log-body"></div>
        </section>
      </main>
    </div>

    <!-- Local Chart.js (open src lib)) -->
    <script src="lib/chart.umd.min.js"></script>
    <!-- Main script -->
    <script src="Stim.js?v=20251119-10"></script>
  </body>
</html>
